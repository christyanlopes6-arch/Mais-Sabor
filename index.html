<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mais Sabor | Premium Delivery</title>
    
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --gold: #C5A059;
            --gold-dark: #9D7B39;
            --gold-light: #F3E5C2;
            --black: #121212;
            --charcoal: #1F1F1F;
            --bg-page: #FAFAFA;
            --white: #FFFFFF;
            --gray-soft: #F4F4F5;
            --text-main: #2D2D2D;
            --text-light: #888888;
            --shadow-soft: 0 20px 40px -10px rgba(0, 0, 0, 0.08);
            --shadow-card: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background-color: var(--bg-page); 
            color: var(--text-main); 
            font-family: 'DM Sans', sans-serif; 
            overflow-x: hidden; 
            padding-bottom: 100px; /* Espa√ßo para o carrinho flutuante */
        }

        /* --- Header Premium --- */
        header {
            position: relative;
            height: 280px;
            background: url('https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=1000&q=80');
            background-size: cover; 
            background-position: center;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 30px;
        }

        /* Gradiente escuro sobre a imagem (Overlay) */
        header::before {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(to top, var(--black) 10%, rgba(0,0,0,0.3) 100%);
        }

        .header-content { position: relative; z-index: 2; text-align: center; }

        header h1 { 
            font-family: 'Playfair Display', serif; 
            font-size: 36px; 
            color: var(--gold); 
            letter-spacing: 1px;
            margin-bottom: 5px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        
        header p { 
            color: rgba(255,255,255,0.9); 
            font-size: 13px; 
            text-transform: uppercase; 
            letter-spacing: 2px; 
            font-weight: 500;
        }

        .container { max-width: 600px; margin: -40px auto 0; padding: 0 20px; position: relative; z-index: 5; }

        /* --- GPS Card (Estilo Dark Luxury) --- */
        .location-card {
            background: var(--charcoal); 
            border: 1px solid #333;
            color: white;
            border-radius: 24px;
            padding: 25px; 
            margin-bottom: 30px; 
            text-align: center; 
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            position: relative; overflow: hidden;
        }

        /* Efeito dourado sutil no fundo */
        .location-card::after {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(197, 160, 89, 0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        .location-card h3 { font-family: 'Playfair Display', serif; color: var(--gold); font-size: 20px; margin-bottom: 8px; }
        .location-card p { font-size: 13px; color: #aaa; margin-bottom: 20px; }
        
        .btn-geo {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
            color: white; border: none; padding: 14px 24px;
            border-radius: 12px; font-weight: 700; cursor: pointer; 
            width: 100%; display: flex; align-items: center; justify-content: center; gap: 10px;
            font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;
            box-shadow: 0 5px 15px rgba(197, 160, 89, 0.3);
            transition: transform 0.2s;
            position: relative; z-index: 2;
        }
        .btn-geo:active { transform: scale(0.97); }

        .geo-error { color: #FF6B6B; font-size: 13px; margin-top: 15px; font-weight: 500; display: none; }
        
        .btn-manual-test {
            background: transparent; color: var(--gold); 
            border: 1px solid var(--gold-dark); 
            margin-top: 15px; padding: 12px; border-radius: 12px; font-size: 13px; font-weight: 600;
            cursor: pointer; display: none; width: 100%; position: relative; z-index: 2;
        }

        /* --- T√≠tulos das Se√ß√µes --- */
        .section-title { 
            font-family: 'Playfair Display', serif;
            font-size: 22px; 
            color: var(--black); 
            margin: 40px 0 20px; 
            display: flex; align-items: center; gap: 15px;
        }
        .section-title::before { content: ''; width: 40px; height: 2px; background: var(--gold); }

        /* --- Cards de Produto --- */
        .product-card {
            background: var(--white); 
            border-radius: 20px; 
            padding: 15px; margin-bottom: 20px;
            display: flex; align-items: center; gap: 20px; 
            box-shadow: var(--shadow-card); 
            transition: all 0.3s; border: 1px solid transparent;
        }
        .product-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-soft); }
        
        .product-img { 
            width: 95px; height: 95px; 
            border-radius: 16px; object-fit: cover; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .product-info { flex: 1; }
        .product-info h3 { font-size: 17px; font-weight: 700; color: var(--black); margin-bottom: 5px; }
        .product-info p { font-size: 13px; color: var(--text-light); margin-bottom: 10px; line-height: 1.4; }
        .product-price { font-size: 16px; font-weight: 700; color: var(--gold-dark); }
        
        .btn-add-item {
            background: var(--black); color: var(--gold); 
            border: none; width: 45px; height: 45px;
            border-radius: 50%; font-size: 22px; cursor: pointer; 
            display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .btn-add-item:active { transform: scale(0.9); background: var(--gold); color: var(--black); }

        .btn-disabled {
            background: var(--gray-soft); color: #ccc; cursor: not-allowed; 
            font-size: 10px; font-weight: bold; width: auto; padding: 10px; border-radius: 8px;
        }

        /* --- Carrinho Flutuante (Glassmorphism) --- */
        #cart-bar {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 92%; max-width: 500px; 
            background: rgba(18, 18, 18, 0.85); /* Dark Glass */
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            padding: 16px 24px; border-radius: 20px; color: white;
            display: none; justify-content: space-between; align-items: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3); z-index: 1000; cursor: pointer;
            border: 1px solid rgba(255,255,255,0.1);
        }

        #cart-count {
            background: var(--gold); color: var(--black); 
            padding: 4px 10px; border-radius: 50px; font-weight: 700; font-size: 13px;
        }

        /* --- Modais e Checkout --- */
        .modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px); display: none; align-items: center; justify-content: center; z-index: 2000;
        }
        .modal-content { 
            background: var(--white); width: 85%; max-width: 380px; padding: 30px; 
            border-radius: 24px; text-align: center; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        }

        .checkout-view {
            position: fixed; inset: 0; background: var(--bg-page); z-index: 3000; 
            display: none; flex-direction: column; overflow-y: auto; padding: 25px;
        }

        .checkout-header {
            display:flex; align-items:center; gap:15px; margin-bottom:30px;
        }
        .checkout-header h2 { font-family: 'Playfair Display', serif; font-size: 24px; color: var(--black); }

        .card-checkout { 
            background: var(--white); border-radius: 20px; padding: 25px; 
            margin-bottom: 20px; border: 1px solid rgba(0,0,0,0.03); 
            box-shadow: var(--shadow-card);
        }

        .card-checkout h4 { 
            font-family: 'Playfair Display', serif; 
            margin-bottom: 20px; color: var(--black); font-size: 18px; 
            border-bottom: 1px solid #f0f0f0; padding-bottom: 10px;
        }

        input, select, textarea { 
            width: 100%; padding: 16px; border-radius: 12px; border: 1px solid #E5E5E5; 
            background: #FAFAFA; font-size: 15px; margin-bottom: 12px; font-family: 'DM Sans', sans-serif;
            transition: 0.3s; outline: none;
        }
        input:focus, select:focus { border-color: var(--gold); background: white; box-shadow: 0 0 0 4px rgba(197, 160, 89, 0.1); }

        .btn-finish { 
            background: var(--black); color: var(--gold); border: none; width: 100%; 
            padding: 20px; border-radius: 16px; font-weight: 700; font-size: 16px; 
            cursor: pointer; margin-top: 10px; text-transform: uppercase; letter-spacing: 1px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .btn-back {
            background: var(--white); border: 1px solid #eee; width: 45px; height: 45px; 
            border-radius: 12px; font-size: 20px; display: flex; align-items: center; justify-content: center;
            box-shadow: var(--shadow-card); color: var(--black);
        }

        #toast { 
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%); 
            background: var(--black); color: var(--gold); padding: 14px 28px; 
            border-radius: 50px; font-size: 14px; font-weight: 600; display: none; z-index: 4000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); letter-spacing: 0.5px;
        }
        
        /* Checkbox do GPS customizado */
        .gps-status-box {
            padding: 15px; border-radius: 12px; font-size: 14px; margin-top: 15px;
            display: flex; align-items: center; gap: 10px;
        }
    </style>
</head>
<body>

<div id="toast">‚ú® Item adicionado com sucesso!</div>

<header>
    <div class="header-content">
        <h1>MAIS SABOR</h1>
        <p>Premium Gastronomy</p>
    </div>
</header>

<div class="container">
    
    <div class="location-card" id="gps-card">
        <h3>üìç Localiza√ß√£o</h3>
        <p>Identifique seu endere√ßo para calcularmos a taxa de entrega corretamente.</p>
        
        <button class="btn-geo" onclick="getLocation()">
            <span>üì°</span> <span id="btn-geo-text">Identificar Localiza√ß√£o</span>
        </button>
        
        <div id="gps-error-msg" class="geo-error"></div>
        
        <button class="btn-manual-test" id="btn-simulate" onclick="simulateLocation()">
            ‚ö†Ô∏è GPS indispon√≠vel? Clique aqui.
        </button>

        <div id="dist-result" style="display:none; margin-top:20px; animation: slideUp 0.3s;"></div>
    </div>

    <div class="section-title">Nossas Marmitex</div>
    
    <div class="product-card">
        <img src="https://images.unsplash.com/photo-1547592166-23ac45744acd?w=300" class="product-img">
        <div class="product-info">
            <h3>Marmitex P</h3>
            <p>Arroz, feij√£o, farofa, guarni√ß√£o + carne.</p>
            <span class="product-price">R$ 22,00</span>
        </div>
        <button class="btn-add-item" onclick="initAdd('Marmita P', 22, true)">+</button>
    </div>

    <div class="product-card">
        <img src="https://images.unsplash.com/photo-1626082896492-766af4eb6501?w=300" class="product-img">
        <div class="product-info">
            <h3>Marmitex M</h3>
            <p>Arroz, feij√£o, farofa, guarni√ß√£o + carne.</p>
            <span class="product-price">R$ 26,00</span>
        </div>
        <button class="btn-add-item" onclick="initAdd('Marmita M', 26, true)">+</button>
    </div>

    <div class="product-card">
        <img src="https://images.unsplash.com/photo-1543353071-873f17a7a088?w=300" class="product-img">
        <div class="product-info">
            <h3>Marmitex G</h3>
            <p>Arroz, feij√£o, farofa, guarni√ß√£o + carne.</p>
            <span class="product-price">R$ 30,00</span>
        </div>
        <button class="btn-add-item" onclick="initAdd('Marmita G', 30, true)">+</button>
    </div>

    <div class="section-title">Especial da Semana</div>
    
    <div class="product-card">
        <img src="https://images.unsplash.com/photo-1604908176997-125f25cc6f3d?w=300" class="product-img">
        <div class="product-info">
            <h3>Feijoada Premium P</h3>
            <p>Arroz, farofa, torresmo e couve.</p>
            <span class="product-price">R$ 25,00</span>
        </div>
        <button class="btn-add-item feijoada-btn" onclick="initAdd('Feijoada P', 25, false)">+</button>
    </div>

    <div class="product-card">
        <img src="https://images.unsplash.com/photo-1604908176997-125f25cc6f3d?w=300" class="product-img">
        <div class="product-info">
            <h3>Feijoada Premium M</h3>
            <p>Arroz, farofa, torresmo e couve.</p>
            <span class="product-price">R$ 28,00</span>
        </div>
        <button class="btn-add-item feijoada-btn" onclick="initAdd('Feijoada M', 28, false)">+</button>
    </div>

    <div class="product-card">
        <img src="https://images.unsplash.com/photo-1604908176997-125f25cc6f3d?w=300" class="product-img">
        <div class="product-info">
            <h3>Feijoada Premium G</h3>
            <p>Arroz, farofa, torresmo e couve.</p>
            <span class="product-price">R$ 32,00</span>
        </div>
        <button class="btn-add-item feijoada-btn" onclick="initAdd('Feijoada G', 32, false)">+</button>
    </div>
</div>

<div id="modal-carne" class="modal">
    <div class="modal-content">
        <h3 style="margin-bottom: 20px; font-family: 'Playfair Display', serif; font-size: 22px;">Escolha a Prote√≠na</h3>
        <select id="select-carne" style="margin-bottom: 25px;">
            <option value="Frango Assado">üçó Frango Assado</option>
            <option value="Bife Acebolado">ü•© Bife Acebolado</option>
            <option value="Carne de Panela">üç≤ Carne de Panela</option>
            <option value="Calabresa">üå≠ Calabresa Acebolada</option>
        </select>
        <button class="btn-finish" style="padding: 15px; font-size: 14px;" onclick="confirmProduct()">Adicionar ao Pedido</button>
        <button onclick="closeModal()" style="margin-top: 15px; background: none; border: none; color: #999; font-weight: 500; cursor: pointer;">Cancelar</button>
    </div>
</div>

<div id="cart-bar" onclick="showCheckout()">
    <div style="display:flex; align-items:center; gap:12px">
        <span id="cart-count">0</span>
        <span style="font-weight: 600; letter-spacing: 0.5px;">Meu Pedido</span>
    </div>
    <div style="display: flex; align-items: center; gap: 10px;">
        <span id="cart-total-bar" style="font-weight: 700; font-size: 16px; color: var(--gold);">R$ 0,00</span>
        <span style="font-size: 18px;">‚Üí</span>
    </div>
</div>

<div id="checkout-view" class="checkout-view">
    <div class="checkout-header">
        <button onclick="hideCheckout()" class="btn-back">‚Üê</button>
        <h2>Finalizar Pedido</h2>
    </div>

    <div class="card-checkout" id="checkout-items"></div>

    <div class="card-checkout">
        <h4>Dados de Entrega</h4>
        <input type="text" id="user-name" placeholder="Seu Nome Completo">
        <input type="text" id="user-address" placeholder="Endere√ßo, N√∫mero e Bairro">
        <input type="text" id="user-obs" placeholder="Ponto de refer√™ncia (Opcional)">
        
        <div id="tax-display-checkout" style="padding: 15px; background: var(--gray-soft); border-radius: 12px; color: #666; font-size: 14px; margin-top: 10px; border: 1px dashed #ccc;">
            ‚ö†Ô∏è Taxa n√£o calculada. Volte e use o GPS.
        </div>
    </div>

    <div class="card-checkout">
        <h4>Pagamento</h4>
        <select id="payment-method" onchange="toggleChangeInput()">
            <option value="Pix">Pix (Chave Celular)</option>
            <option value="Cart√£o">Cart√£o (Cr√©dito / D√©bito)</option>
            <option value="Dinheiro">Dinheiro</option>
        </select>

        <div id="change-box" style="display:none; margin-top: 10px;">
            <label style="font-size:13px; font-weight:bold; color:var(--text-main); margin-bottom: 5px; display: block;">Precisa de troco para quanto?</label>
            <input type="text" id="change-value" placeholder="Ex: R$ 50,00 ou N√£o precisa">
        </div>
    </div>

    <div style="margin-top: auto; padding-bottom: 30px;">
        <div style="display:flex; justify-content:space-between; font-size: 20px; font-weight: 800; margin-bottom: 20px; padding: 0 5px; font-family: 'Playfair Display', serif;">
            <span>Total Final</span>
            <span id="final-price" style="color: var(--gold-dark);">R$ 0,00</span>
        </div>
        <button class="btn-finish" onclick="sendOrder()">Concluir Pedido via WhatsApp</button>
    </div>
</div>

<script>
    let cart = [];
    let currentItem = null;
    let deliveryTax = 0;
    let distanceKm = 0;
    let locationFixed = false;
    let isTaxPending = false; 

    // Coordenadas Mais Sabor (Exemplo Jarinu/SP)
    const RESTAURANT_LAT = -23.0905;
    const RESTAURANT_LON = -46.6853;

    window.onload = () => {
        if(localStorage.getItem('ms_name')) document.getElementById('user-name').value = localStorage.getItem('ms_name');
        if(localStorage.getItem('ms_address')) document.getElementById('user-address').value = localStorage.getItem('ms_address');
        checkFeijoadaAvailability();
    };

    function checkFeijoadaAvailability() {
        const today = new Date().getDay(); 
        const isFeijoadaDay = (today === 3 || today === 6);
        const btns = document.querySelectorAll('.feijoada-btn');
        if (!isFeijoadaDay) {
            btns.forEach(btn => {
                btn.onclick = null;
                btn.classList.add('btn-disabled');
                btn.classList.remove('btn-add-item');
                btn.innerHTML = "Indisp.";
                btn.parentElement.style.opacity = "0.6"; // Visual mais apagado
            });
        }
    }

    function toggleChangeInput() {
        const method = document.getElementById('payment-method').value;
        const changeBox = document.getElementById('change-box');
        changeBox.style.display = (method === 'Dinheiro') ? 'block' : 'none';
    }

    function getLocation() {
        const btnText = document.getElementById('btn-geo-text');
        const errorMsg = document.getElementById('gps-error-msg');
        const btnSimulate = document.getElementById('btn-simulate');
        
        errorMsg.style.display = 'none';
        btnSimulate.style.display = 'none';
        btnText.innerText = "Localizando...";

        if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
            handleGpsError({ code: 999, message: "HTTPS Obrigat√≥rio" });
            return;
        }

        if (!navigator.geolocation) {
            handleGpsError({ code: 998, message: "Sem suporte a GPS" });
            return;
        }

        navigator.geolocation.getCurrentPosition(successLocation, handleGpsError, { enableHighAccuracy: true, timeout: 10000 });
    }

    function successLocation(position) {
        const userLat = position.coords.latitude;
        const userLon = position.coords.longitude;
        isTaxPending = false; 
        calculateDistance(userLat, userLon);
    }

    function handleGpsError(error) {
        const btnText = document.getElementById('btn-geo-text');
        const errorMsg = document.getElementById('gps-error-msg');
        const btnSimulate = document.getElementById('btn-simulate');

        btnText.innerText = "Tentar Novamente";
        errorMsg.style.display = 'block';
        btnSimulate.style.display = 'block';

        let msg = "Erro ao obter localiza√ß√£o.";
        if (error.code === 1) msg = "Permiss√£o de localiza√ß√£o negada.";
        if (error.code === 2) msg = "Sinal de GPS indispon√≠vel.";
        if (error.code === 3) msg = "Tempo limite esgotado.";
        
        errorMsg.innerText = msg;
    }

    function calculateDistance(lat, lon) {
        const R = 6371; 
        const dLat = (lat - RESTAURANT_LAT) * Math.PI / 180;
        const dLon = (lon - RESTAURANT_LON) * Math.PI / 180;
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(RESTAURANT_LAT * Math.PI / 180) * Math.cos(lat * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        
        distanceKm = (R * c) * 1.7;

        if (distanceKm <= 4) {
            deliveryTax = 0;
        } else {
            deliveryTax = distanceKm * 1.50;
        }
        updateGpsUI(true);
    }

    function simulateLocation() {
        isTaxPending = true;
        distanceKm = 0;
        deliveryTax = 0;
        updateGpsUI(false);
    }

    function updateGpsUI(isRealGps) {
        const resultDiv = document.getElementById('dist-result');
        const btnText = document.getElementById('btn-geo-text');
        const btn = document.querySelector('.btn-geo');
        const taxCheckout = document.getElementById('tax-display-checkout');

        locationFixed = true;
        document.getElementById('gps-error-msg').style.display = 'none';
        document.getElementById('btn-simulate').style.display = 'none';

        if (isTaxPending) {
            // MODO TAXA PENDENTE (ESTILO NOVO)
            btn.style.background = "var(--charcoal)";
            btn.style.color = "var(--gold)";
            btn.style.border = "1px solid var(--gold)";
            btnText.innerText = "Localiza√ß√£o Manual (Ativada)";
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <div class="gps-status-box" style="background: rgba(197, 160, 89, 0.15); color: var(--gold); border: 1px solid var(--gold);">
                    <span>‚ö†Ô∏è</span>
                    <div>
                        <b>Sujeito a taxa de entrega</b><br>
                        <span style="font-size:12px; opacity:0.8">Calcularemos via WhatsApp ap√≥s envio.</span>
                    </div>
                </div>
            `;
            
            taxCheckout.innerHTML = `<span style="color:#B45309">‚ö†Ô∏è Taxa de Entrega: <b>A verificar</b></span>`;
            taxCheckout.style.background = "#FFFBEB";
            taxCheckout.style.border = "1px solid #FCD34D";

        } else {
            // MODO GPS NORMAL (ESTILO NOVO)
            btn.style.background = "var(--white)";
            btn.style.color = "#10B981";
            btnText.innerText = "Localiza√ß√£o Confirmada";
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <div class="gps-status-box" style="background: rgba(16, 185, 129, 0.1); color: #047857; border: 1px solid #10B981;">
                    <span>‚úÖ</span>
                    <div>
                        <b>Dist√¢ncia: ${distanceKm.toFixed(1)} km</b><br>
                        Taxa: <b style="font-size:15px">${deliveryTax === 0 ? 'GR√ÅTIS' : 'R$ ' + deliveryTax.toFixed(2)}</b>
                    </div>
                </div>
            `;

            taxCheckout.innerHTML = `‚úÖ Taxa: <b>${deliveryTax === 0 ? 'Gr√°tis' : 'R$ '+deliveryTax.toFixed(2)}</b>`;
            taxCheckout.style.background = "#ECFDF5";
            taxCheckout.style.border = "1px solid #10B981";
            taxCheckout.style.color = "#047857";
        }

        renderCart();
    }

    function initAdd(name, price, needsProtein) {
        if (needsProtein) {
            currentItem = { name, price };
            document.getElementById('modal-carne').style.display = 'flex';
        } else {
            addToCart(name, price);
        }
    }

    function confirmProduct() {
        const protein = document.getElementById('select-carne').value;
        addToCart(`${currentItem.name} (${protein})`, currentItem.price);
        closeModal();
    }

    function addToCart(desc, price) {
        cart.push({ desc, price });
        showToast();
        renderCart();
    }

    function renderCart() {
        const subtotal = cart.reduce((sum, item) => sum + item.price, 0);
        const total = subtotal + deliveryTax;
        
        const totalString = isTaxPending ? `R$ ${subtotal.toFixed(2)} + Taxa` : `R$ ${total.toFixed(2)}`;

        const cartBar = document.getElementById('cart-bar');
        if (cart.length > 0) {
            cartBar.style.display = 'flex';
            document.getElementById('cart-count').innerText = cart.length;
            document.getElementById('cart-total-bar').innerText = totalString;
        } else {
            cartBar.style.display = 'none';
        }

        document.getElementById('final-price').innerText = totalString;

        const container = document.getElementById('checkout-items');
        if (cart.length === 0) {
            container.innerHTML = '<p style="text-align:center; color:#999; font-style:italic;">Seu pedido est√° vazio.</p>';
        } else {
            container.innerHTML = cart.map((item, index) => `
                <div style="display:flex; justify-content:space-between; align-items:center; padding:15px 0; border-bottom:1px solid #f5f5f5;">
                    <div style="font-size:15px; color:var(--black);">
                        <b style="font-family:'DM Sans'">${item.desc}</b><br>
                        <span style="color:var(--gold-dark); font-weight:700">R$ ${item.price.toFixed(2)}</span>
                    </div>
                    <button onclick="removeItem(${index})" style="background:#FFF1F2; color:#E11D48; border:none; padding:8px 12px; border-radius:10px; font-weight:700; font-size:12px; cursor:pointer;">Remover</button>
                </div>
            `).join('');
        }
    }

    function removeItem(index) {
        cart.splice(index, 1);
        renderCart();
    }

    function showToast() {
        const t = document.getElementById('toast');
        t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 2500);
    }

    function showCheckout() { document.getElementById('checkout-view').style.display = 'flex'; }
    function hideCheckout() { document.getElementById('checkout-view').style.display = 'none'; }
    function closeModal() { document.getElementById('modal-carne').style.display = 'none'; }

    function sendOrder() {
        const name = document.getElementById('user-name').value;
        const addr = document.getElementById('user-address').value;
        const obs = document.getElementById('user-obs').value;
        const pay = document.getElementById('payment-method').value;
        const changeVal = document.getElementById('change-value').value;
        const totalDisplay = document.getElementById('final-price').innerText;

        if (!name || !addr) return alert("Por favor, preencha seu Nome e Endere√ßo.");
        if (cart.length === 0) return alert("Seu carrinho est√° vazio.");
        if (!locationFixed) return alert("Por favor, precisamos que confirme sua localiza√ß√£o no topo da tela.");

        localStorage.setItem('ms_name', name);
        localStorage.setItem('ms_address', addr);

        let msg = `*‚öúÔ∏è NOVO PEDIDO - MAIS SABOR ‚öúÔ∏è*%0A%0A`;
        cart.forEach(i => msg += `‚ñ™Ô∏è ${i.desc} - R$ ${i.price.toFixed(2)}%0A`);
        
        if (isTaxPending) {
            msg += `%0A‚ö†Ô∏è *Taxa Entrega:* A verificar (Localiza√ß√£o Manual)`;
        } else {
            msg += `%0Aüöö *Taxa Entrega:* R$ ${deliveryTax.toFixed(2)} (${distanceKm.toFixed(1)}km)`;
        }

        msg += `%0Aüíé *TOTAL:* ${totalDisplay}`;
        msg += `%0A%0Aüë§ *Cliente:* ${name}`;
        msg += `%0Aüìç *Endere√ßo:* ${addr}`;
        if(obs) msg += `%0Aüìù *Obs:* ${obs}`;
        
        msg += `%0Aüí≥ *Pagamento:* ${pay}`;
        if(pay === 'Dinheiro' && changeVal) msg += `%0Aüíµ *Troco para:* ${changeVal}`;

        window.open(`https://wa.me/5511999999999?text=${msg}`, '_blank');
    }
</script>

</body>
</html>